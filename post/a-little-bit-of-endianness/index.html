<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.2.5">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Matthew Turk">

  
  
  
    
  
  <meta name="description" content="(Confession time: I did not even realize I was mildly-punning in that title.)
Over the last few months, my hobby-time has mostly been focused on some reverse engineering of old DOS games I played as a kid. The fruits of that will wait for another blog post, but this has led to some very fun investigations using the DOSbox debugger, Ghidra and learning the Ghidra API to decompile MS-DOS system calls (especially int 21h) properly.">

  
  <link rel="alternate" hreflang="en-us" href="https://matthewturk.github.io/post/a-little-bit-of-endianness/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#EF525B">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.160c9711abc197a38ee59f0961dc31dc.css">

  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-141183895-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://matthewturk.github.io/post/a-little-bit-of-endianness/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@powersoffour">
  <meta property="twitter:creator" content="@powersoffour">
  
  <meta property="og:site_name" content="mjt">
  <meta property="og:url" content="https://matthewturk.github.io/post/a-little-bit-of-endianness/">
  <meta property="og:title" content="A Little Bit of Endianness | mjt">
  <meta property="og:description" content="(Confession time: I did not even realize I was mildly-punning in that title.)
Over the last few months, my hobby-time has mostly been focused on some reverse engineering of old DOS games I played as a kid. The fruits of that will wait for another blog post, but this has led to some very fun investigations using the DOSbox debugger, Ghidra and learning the Ghidra API to decompile MS-DOS system calls (especially int 21h) properly."><meta property="og:image" content="https://matthewturk.github.io/img/icon-192.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2020-01-23T16:28:15-06:00">
  
  <meta property="article:modified_time" content="2020-01-23T16:30:58-06:00">
  

  

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#EF525B",
          "text": "#EAE7D6"
        },
        "button": {
          "background": "#EAE7D6",
          "text": "#EF525B"
        }
      },
      "theme": "classic",
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on our website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "https://cookies.insites.com"
      }
    })});
</script>


  

  <title>A Little Bit of Endianness | mjt</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">mjt</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#courses">
            
            <span>Courses</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#talks">
            
            <span>Talks</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#publications">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
            
          
        

        <li class="nav-item">
          <a class="nav-link" href="https://data-exp-lab.github.io/" target="_blank" rel="noopener">
            
            <span>Research Group</span>
            
          </a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        

      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">A Little Bit of Endianness</h1>

  

  
    



<meta content="2020-01-23 16:28:15 -0600 CST" itemprop="datePublished">
<meta content="2020-01-23 16:30:58 -0600 CST" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    <time>Jan 23, 2020</time>
  </span>
  

  

  

  
  

  
  

  
    

  

</div>

    








  









  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      <p>(Confession time: I did not even realize I was mildly-punning in that title.)</p>

<p>Over the last few months, my hobby-time has mostly been focused on some reverse engineering of old DOS games I played as a kid.  The fruits of that will wait for another blog post, but this has led to some very fun investigations using the <a href="https://www.vogons.org/viewtopic.php?t=3944" target="_blank">DOSbox debugger</a>, <a href="http://ghidra-sre.org/" target="_blank">Ghidra</a> and learning the Ghidra API to decompile MS-DOS system calls (especially <a href="http://bbc.nvg.org/doc/Master%20512%20Technical%20Guide/m512techb_int21.htm" target="_blank">int 21h</a>) properly.</p>

<p>A particularly fun aspect of doing all this, though, has been realizing just how much this has in common with the early stages of developing yt, when we had to reverse engineer file formats like it was going out of style.</p>

<p>One of the things that constantly <em>constantly</em> showed up in reverse engineering these formats was making sure our endianness was right.  Since we were often dealing with 32-bit values that had uncertain units, and where the values themselves could be quite the extreme and not <em>too</em> far from the limits of representation, it wasn&rsquo;t always immediately obvious if we had it right or not.</p>

<p>To be completely honest, the thing that always threw me (and sometimes still does, when I&rsquo;m thinking about ordering of numbers on the stack and in registers) is how numbers get represented as bits in memory, and more specifically, what the difference between &ldquo;big&rdquo; and &ldquo;little&rdquo; endian really is.</p>

<p>Also, for a much better description and walkthrough, please feel free to visit the <a href="https://en.wikipedia.org/wiki/Endianness" target="_blank">wikipedia article</a>.  Its load time is probably comparable to the reading time of this rather brief foray into views.</p>

<pre><code class="language-python">import numpy as np
</code></pre>

<p>To get started, let&rsquo;s make an array that isn&rsquo;t symmetric at the &ldquo;word&rdquo; level.  I&rsquo;ll use my favorite value offset by one to do this.  (Remember for later that we&rsquo;re using a number as our base that is greater than can be represented in two bytes, so it truncates at <code>u2</code> size.)</p>

<p>We&rsquo;ll use numpy&rsquo;s ability to encode arrays using different internal representations &ndash; the first array will be in &ldquo;little&rdquo; endian, 2-byte unsigned integers, and the second will be in &ldquo;big&rdquo; endian, 2-byte integers.  We toggle between the two with the <code>&lt;</code> and <code>&gt;</code> operators before the data type specification.</p>

<pre><code class="language-python">arr_little = np.array([0x4d3d3 - 1]).astype(&quot;&lt;u2&quot;)
arr_big = arr_little.astype(&quot;&gt;u2&quot;)
arr_big, arr_little
</code></pre>

<pre><code>(array([54226], dtype=uint16), array([54226], dtype=uint16))
</code></pre>

<p>So, they&rsquo;re definitely the same values when we print them out!  But that&rsquo;s because even though they are encoded differently internally, when we print them, we use a representation that is encoding aware.  What happens if we force the issue, though?  Let&rsquo;s try, by asking to view them in &ldquo;unsigned bytes&rdquo; format by using the <code>view</code> method with the argument <code>B</code> to indicate the dtype.</p>

<pre><code class="language-python">print(&quot;Little endian: {}\nBig endian:    {}&quot;.format(arr_little.view(&quot;B&quot;), arr_big.view(&quot;B&quot;)))
</code></pre>

<pre><code>Little endian: [210 211]
Big endian:    [211 210]
</code></pre>

<p>Interesting!  Note that the individual bytes are the same (and there are two in each one), but the order is different.</p>

<p>We can make this even more clear if we look at the binary and hex representations of them:</p>

<pre><code class="language-python">print(&quot;Little endian: {}\nBig endian:    {}&quot;.format(*[[bin(_)[2:] for _ in arr.view(&quot;B&quot;)] for arr in (arr_little, arr_big)]))
</code></pre>

<pre><code>Little endian: ['11010010', '11010011']
Big endian:    ['11010011', '11010010']
</code></pre>

<pre><code class="language-python">print(&quot;Little endian: {}\nBig endian:    {}&quot;.format(*[[hex(_)[2:].upper() for _ in arr.view(&quot;B&quot;)] for arr in (arr_little, arr_big)]))
</code></pre>

<pre><code>Little endian: ['D2', 'D3']
Big endian:    ['D3', 'D2']
</code></pre>

<p>What I always found the most difficult about endianness is that the <strong>bits</strong> aren&rsquo;t actually reversed &ndash; what is reversed is the order of the bytes, but within a given byte the bits remain the same.  This gets even more fun with 32 and 64 bit integers.</p>

<pre><code class="language-python">arr_little32 = np.array([0x4d3d3 - 1]).astype(&quot;&lt;u4&quot;)
arr_big32 = arr_little32.astype(&quot;&gt;u4&quot;)
arr_big32, arr_little32
</code></pre>

<pre><code>(array([316370], dtype=uint32), array([316370], dtype=uint32))
</code></pre>

<pre><code class="language-python">print(&quot;Little endian: {}\nBig endian:    {}&quot;.format(*[[hex(_)[2:].upper() for _ in arr.view(&quot;B&quot;)] for arr in (arr_little32, arr_big32)]))
</code></pre>

<pre><code>Little endian: ['D2', 'D3', '4', '0']
Big endian:    ['0', '4', 'D3', 'D2']
</code></pre>

<p>Of course, Wikipedia has an <a href="https://en.wikipedia.org/wiki/Endianness" target="_blank">awesome article</a> with a great <a href="https://en.wikipedia.org/wiki/Endianness#Illustration" target="_blank">illustration</a> that demonstrates all of this.</p>

    </div>

    



    
      

      
      
    

    

    


  </div>
</article>

<div class="container">
  <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
        
      

      
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.ee93f50e7bcdd181a29c10939fba4467.js"></script>

  </body>
</html>

