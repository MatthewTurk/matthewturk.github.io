<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.2.5">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Matthew Turk">

  
  
  
    
  
  <meta name="description" content="In this blogpost, I walk through the annoying bits about loading unknown data into yt.">

  
  <link rel="alternate" hreflang="en-us" href="https://matthewturk.github.io/post/loading_data_in_yt/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#EF525B">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.331f53d055a276ccbdada146254dc48b.css">

  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-141183895-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://matthewturk.github.io/post/loading_data_in_yt/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@powersoffour">
  <meta property="twitter:creator" content="@powersoffour">
  
  <meta property="og:site_name" content="mjt">
  <meta property="og:url" content="https://matthewturk.github.io/post/loading_data_in_yt/">
  <meta property="og:title" content="Loading data in yt: Can we make it better? | mjt">
  <meta property="og:description" content="In this blogpost, I walk through the annoying bits about loading unknown data into yt."><meta property="og:image" content="https://matthewturk.github.io/img/icon-192.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-07-01T14:47:41-05:00">
  
  <meta property="article:modified_time" content="2019-07-01T14:51:44-05:00">
  

  

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#EF525B",
          "text": "#EAE7D6"
        },
        "button": {
          "background": "#EAE7D6",
          "text": "#EF525B"
        }
      },
      "theme": "classic",
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on our website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "https://cookies.insites.com"
      }
    })});
</script>


  

  <title>Loading data in yt: Can we make it better? | mjt</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">mjt</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#courses">
            
            <span>Courses</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#talks">
            
            <span>Talks</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#publications">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
            
          
        

        <li class="nav-item">
          <a class="nav-link" href="https://data-exp-lab.github.io/" target="_blank" rel="noopener">
            
            <span>Research Group</span>
            
          </a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        

      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Loading data in yt: Can we make it better?</h1>

  

  
    



<meta content="2019-07-01 14:47:41 -0500 CDT" itemprop="datePublished">
<meta content="2019-07-01 14:51:44 -0500 CDT" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    <time>Jul 1, 2019</time>
  </span>
  

  

  

  
  

  
  

  
    

  

</div>

    








  








<div class="btn-links mb-3">
  
  








  









  
  <a class="btn btn-outline-primary my-1 mr-1" href="/project/yt/">
    Project
  </a>
  











</div>


  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      <p>For all the data formats that yt knows about, reading a dataset is supposed to be <em>trivial</em> &ndash; the <code>yt.load</code> command knows how to parse the metadata of something like 30-50 different dialects of data, generate the in-memory representation, and even manage things like the coordinate system (Spherical? Cartesian? etc) and how to apply spatial transformations.</p>
<p>But, if you're just experimenting or trying to get a new frontend going, right now it's too hard to load data into yt.  (Before you think I'm passing the buck, though: this is kind of my fault.)</p>
<h2 id="loading-some-spherical-data">Loading some spherical data</h2>
<p>Last week, I worked with some folks to load in data from a simulation code called <a href="https://www.phy.ornl.gov/groups/astro_theory/ccsn/ccmodeling.html">CHIMERA</a>.  The data specifically was a 2D axially symmetric dataset, with log-spaced bins in the radial direction.  The file format was really quite straightforward, too!</p>
<p>Usually when developing a frontend to make all of this easier, the first step is to load the data into yt using the <code>Stream</code> frontend.  This has functions like <code>load_amr_grids</code>, <code>load_uniform_grid</code>, <code>load_unstructured_mesh</code>, <code>load_particles</code> and so on.  But, it was pretty annoying to load the data into yt.  And it seems like it should be a lot simpler.</p>
<p>Let's dig in, following along as I had explored it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> h5py
<span style="color:#f92672">import</span> yt
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np

f <span style="color:#f92672">=</span> h5py<span style="color:#f92672">.</span>File(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">chimera_000661800_grid_1_01.h5</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;</span>)
f<span style="color:#f92672">.</span>keys()
</code></pre></div><pre><code>&lt;KeysViewHDF5 ['abundance', 'analysis', 'fluid', 'mesh', 'metadata', 'radiation', 'tracking']&gt;
</code></pre>
<p>Without any additional information, my first guess is to look at the <code>mesh</code> dataset &ndash; that's likely where I'm going to find the information for how the dataset is organized.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">f[<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/mesh</span><span style="color:#e6db74">&#34;</span>]<span style="color:#f92672">.</span>keys()
</code></pre></div><pre><code>&lt;KeysViewHDF5 ['array_dimensions', 'cycle', 'd_omega', 'dx_cf', 'dy_cf', 'dz_cf', 'i_frame', 'last_frame', 'my_hyperslab_group', 'nz_hyperslabs', 'ongrid_mask', 'phi_index_bound', 'r_comv', 'radial_index_bound', 't_bounce', 'theta_index_bound', 'time', 'time_steps', 'x_cf', 'x_ef', 'y_cf', 'y_ef', 'z_cf', 'z_ef']&gt;
</code></pre>
<p>Well, here we go!  Lots of interesting things to look at.  I'll save a bit of time here and note that the things we're interested in are the <code>array_dimensions</code> and the various <code>_ef</code> arrays:  <code>x_ef</code>, <code>y_ef</code>, <code>z_ef</code>.  These are the dimensions of the simulation and the cell edges, respectively.  There are other interesting things here as well, but for our current purposes, this is what we want to look at.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dims <span style="color:#f92672">=</span> f[<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/mesh/array_dimensions</span><span style="color:#e6db74">&#34;</span>][()]
xgrid, ygrid, zgrid <span style="color:#f92672">=</span> (f[<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/mesh/{}_ef</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(ax)][()] <span style="color:#66d9ef">for</span> ax <span style="color:#f92672">in</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">xyz</span><span style="color:#e6db74">&#39;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">xgrid<span style="color:#f92672">.</span>shape, ygrid<span style="color:#f92672">.</span>shape, zgrid<span style="color:#f92672">.</span>shape, dims
</code></pre></div><pre><code>((723,), (241,), (2,), array([722, 240,   1], dtype=int32))
</code></pre>
<p>We're dealing with cell edges here so we have one more in each dimension than the cell-centered variables.  Great!  Everything is going according to plan so far.</p>
<p>(You might be thinking to yourself, &ldquo;Gee, wouldn't it be nice if this 1:1 mapping of values to what yt expects was easier to set up?&rdquo;  I certainly was.)</p>
<p>Let's see what fields we can load up:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">f[<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/fluid</span><span style="color:#e6db74">&#34;</span>]<span style="color:#f92672">.</span>keys()
</code></pre></div><pre><code>&lt;KeysViewHDF5 ['LScompress', 'agr_c', 'agr_e', 'c_eos_i', 'dimeos', 'dudt_nu', 'dudt_nuc', 'e_int', 'entropy', 'eos_rho', 'grav_x_c', 'grav_y_c', 'grav_z_c', 'press', 'rho_c', 't_c', 'u_c', 'v_c', 'v_csound', 'wBVMD', 'w_c', 'ye_c', 'ylep']&gt;
</code></pre>
<p>Some might have reduced dimensionality, so we'll take a look at what will be the most obvious to load in by identifying which have the right dimensionality.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> collections
collections<span style="color:#f92672">.</span>Counter(f[<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/fluid</span><span style="color:#e6db74">&#34;</span>][v]<span style="color:#f92672">.</span>shape <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> f[<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/fluid</span><span style="color:#e6db74">&#34;</span>])
</code></pre></div><pre><code>Counter({(): 1, (722,): 1, (723,): 1, (1,): 2, (2,): 1, (1, 240, 722): 17})
</code></pre>
<p>Looks like the fluid fields are stored in reverse order from the <code>dims</code> array, so let's populate our dictionary (all in-memory) with this info.</p>
<p>We'll grab the transpose, though, so that we keep the same ijk ordering as specified in the dimensions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">data <span style="color:#f92672">=</span> {n: v[()]<span style="color:#f92672">.</span>T <span style="color:#66d9ef">for</span> n, v <span style="color:#f92672">in</span> f[<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/fluid</span><span style="color:#e6db74">&#34;</span>]<span style="color:#f92672">.</span>items() <span style="color:#66d9ef">if</span> v<span style="color:#f92672">.</span>shape <span style="color:#f92672">==</span> tuple(dims[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])}
data<span style="color:#f92672">.</span>keys()
</code></pre></div><pre><code>dict_keys(['dudt_nu', 'dudt_nuc', 'e_int', 'entropy', 'grav_x_c', 'grav_y_c', 'grav_z_c', 'press', 'rho_c', 't_c', 'u_c', 'v_c', 'v_csound', 'wBVMD', 'w_c', 'ye_c', 'ylep'])
</code></pre>
<p>We can now proceed!  Let's generate our semi-structured mesh from our coordinate info and load it all in.</p>
<p>This next function generates a full set of coordinates and connectivity to make our hexahedral mesh look like a structured system.  (This is a place that yt could use some improvement, to speed things up by not requiring this hoop-jumping!)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">coord, conn <span style="color:#f92672">=</span> yt<span style="color:#f92672">.</span>hexahedral_connectivity(xgrid, ygrid, zgrid)
</code></pre></div><p>Next up will be loading things in using the <code>yt.load_hexahedral_mesh</code> function, so let's look at the docstring for that.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">yt<span style="color:#f92672">.</span>load_hexahedral_mesh<span style="color:#960050;background-color:#1e0010">?</span>
</code></pre></div><pre><code>Signature:
yt.load_hexahedral_mesh(
    data,
    connectivity,
    coordinates,
    length_unit=None,
    bbox=None,
    sim_time=0.0,
    mass_unit=None,
    time_unit=None,
    velocity_unit=None,
    magnetic_unit=None,
    periodicity=(True, True, True),
    geometry='cartesian',
    unit_system='cgs',
)
Docstring:
Load a hexahedral mesh of data into yt as a
:class:`~yt.frontends.stream.data_structures.StreamHandler`.

This should allow a semistructured grid of data to be loaded directly into
yt and analyzed as would any others.  This comes with several caveats:

* Units will be incorrect unless the data has already been converted to
  cgs.
* Some functions may behave oddly, and parallelism will be
  disappointing or non-existent in most cases.
* Particles may be difficult to integrate.

Particle fields are detected as one-dimensional fields. The number of particles
is set by the &quot;number_of_particles&quot; key in data.

Parameters
----------
data : dict
    This is a dict of numpy arrays, where the keys are the field names.
    There must only be one. Note that the data in the numpy arrays should
    define the cell-averaged value for of the quantity in in the hexahedral
    cell.
connectivity : array_like
    This should be of size (N,8) where N is the number of zones.
coordinates : array_like
    This should be of size (M,3) where M is the number of vertices
    indicated in the connectivity matrix.
bbox : array_like (xdim:zdim, LE:RE), optional
    Size of computational domain in units of the length unit.
sim_time : float, optional
    The simulation time in seconds
mass_unit : string
    Unit to use for masses.  Defaults to unitless.
time_unit : string
    Unit to use for times.  Defaults to unitless.
velocity_unit : string
    Unit to use for velocities.  Defaults to unitless.
magnetic_unit : string
    Unit to use for magnetic fields. Defaults to unitless.
periodicity : tuple of booleans
    Determines whether the data will be treated as periodic along
    each axis
geometry : string or tuple
    &quot;cartesian&quot;, &quot;cylindrical&quot;, &quot;polar&quot;, &quot;spherical&quot;, &quot;geographic&quot; or
    &quot;spectral_cube&quot;.  Optionally, a tuple can be provided to specify the
    axis ordering -- for instance, to specify that the axis ordering should
    be z, x, y, this would be: (&quot;cartesian&quot;, (&quot;z&quot;, &quot;x&quot;, &quot;y&quot;)).  The same
    can be done for other coordinates, for instance:
    (&quot;spherical&quot;, (&quot;theta&quot;, &quot;phi&quot;, &quot;r&quot;)).
File:      ~/yt/yt/yt/frontends/stream/data_structures.py
Type:      function
</code></pre>
<p>Looks like we've got just about everything except for the bounding box.  So let's generate that.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">bbox <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([
    [xgrid<span style="color:#f92672">.</span>min(), xgrid<span style="color:#f92672">.</span>max()],
    [ygrid<span style="color:#f92672">.</span>min(), ygrid<span style="color:#f92672">.</span>max()],
    [zgrid<span style="color:#f92672">.</span>min(), zgrid<span style="color:#f92672">.</span>max()]
])
bbox
</code></pre></div><pre><code>array([[0.00000000e+00, 7.70275059e+09],
       [0.00000000e+00, 3.14159265e+00],
       [0.00000000e+00, 6.28318531e+00]])
</code></pre>
<p>And the last thing we need to do is to specify the geometry.  This dataset is spherical (but with only one value along the azimuthal direction, in this case) and so we have to specify which coordinate is which.  We do that using the <code>geometry</code> keyword argument, where we specify not only the geometry's name, but the axis-ordering.</p>
<p>Here we have:</p>
<ul>
<li><code>r</code> is the first dimension</li>
<li><code>theta</code> is the declination, which spans an interval of $\pi$, so it's the second dimension</li>
<li><code>phi</code> is our azimuthal angle, which goes $2\pi$ (and here is identical at all azimuthal angles) so it's the third.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">ds <span style="color:#f92672">=</span> yt<span style="color:#f92672">.</span>load_hexahedral_mesh(data, conn, coord, bbox <span style="color:#f92672">=</span> bbox, geometry <span style="color:#f92672">=</span> (<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">spherical</span><span style="color:#e6db74">&#34;</span>, (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">theta</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">phi</span><span style="color:#e6db74">&#39;</span>)))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">s <span style="color:#f92672">=</span> yt<span style="color:#f92672">.</span>SlicePlot(ds, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">phi</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">e_int</span><span style="color:#e6db74">&#34;</span>)
s<span style="color:#f92672">.</span>show()
</code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>Looks kinda right!  Unfortunately it's a bit tricky to navigate these coordinates in the version of yt I'm running, so we have to do a bit of work to get ourselves zoomed in to see things closer up.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">s<span style="color:#f92672">.</span>set_center( (<span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>) )
s<span style="color:#f92672">.</span>zoom(<span style="color:#ae81ff">50</span>)
s<span style="color:#f92672">.</span>pan_rel((<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.0</span>))
</code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>We're now at the point that things can be used, but &hellip; it was kind of irritating getting here!</p>
<h2 id="what-have-we-learned">What have we learned?</h2>
<p>Good question!  The first thing I thought as I was going through this was that I did an awful lot of work for what amounted to a one-to-one mapping between the dataset and the arguments that yt expected.  It feels like I should just be able to mark all of this up with some metadata to make the loading process much easier, before writing a specific frontend that manages this all for us.</p>
<p>Over the last few days, a collaborator (Sam Walkow) at UIUC and I started brainstorming what a metadata schema would look like that could map from a file format directly to yt.  One of the advantages of having this explicitly typed and validated is that we can check for errors earlier in the process and we can also make logical leaps from one piece of information to another.</p>
<p>For instance, note that above we define the <code>bbox</code> <em>independently</em> of the coordinate system.  But, for a dataset like this, they will usually be the same!  And, since we're dealing with an HDF5 dataset, we should be able to just specify that.</p>
<p>We've started drafting what this <em>might</em> look like, using <a href="https://json-schema.org">JSON-Schema</a> via <a href="https://pydantic-docs.helpmanual.io">PyDantic</a> and some helper classes.  Ideally, we should be able to specify something in <code>yaml</code> that describes how to get everything we want.  Imagine, if instead of what we showed above, we had a small schema that yt could read and that could potentially even live as a sidecar file!  (And then we could even <a href="https://jupyter.readthedocs.io/en/latest/reference/mimetype.html">register a mimetype</a> for display in Jupyterlab&hellip;)  We've been exploring using this for declarative analysis, to reduce the burden of writing out lots of boilerplate code, but it seems like it would be a great match for this, too.</p>
<p>Anyway, I was speculating that something like this &ndash; but accounting for an explicitly declared list of fields, etc &ndash; might be sufficient.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">metadata:
  filetype: hdf5
  geometry:
    dimensions: /mesh/array_dimensions
    spherical:
      order: [r, theta, phi]
    bbox: implicit
    hexahedral_mesh:
      edges: [/mesh/x_ef, /mesh/y_ef, /mesh/z_ef]
  fields:
    implicit: <span style="color:#66d9ef">true</span>
    root: /fluid
    validate: <span style="color:#66d9ef">true</span>
    process: transpose
</code></pre></div><p>This doesn't yet work, but I think it gives a target for how we might think about making it much easier to load in data in formats that have such a nice mapping between yt and the dataset.  And it leaves enough room for things like on-demand loading (which the stream frontend <em>does</em> support, but in an opaque way) that it could be quite nice to extend this in the future.</p>
<p>I've pretty much talked myself into doing something like this and seeing how it'd work.  Maybe it could be a <a href="https://www.scipy2019.scipy.org/">SciPy project</a> next week!</p>
<h2 id="acknowledgments">Acknowledgments</h2>
<p>Thanks to Bronson Messer, Ronan Hix and Samantha Walkow for the data and speculating, and to Nathan Goldbaum for planting this &ldquo;let's just write a yaml declaration&rdquo; idea in my head a million years ago.  (It took me a while to catch up to how insightful an idea that was.)</p>
<p>It's also probably worth mentioning that these amazing revelations I'm having are &hellip; not that new to lots of people using data!  I mean, folks working on things like <a href="http://docs.astropy.org/en/stable/visualization/wcsaxes/">wcsaxes</a> and <a href="https://www.unidata.ucar.edu/software/thredds/current/netcdf-java/metadata/ncACDD-metadataMappings.html">netCDF metadata</a> and lots of others have trod this ground before!</p>

    </div>

    



    
      

      
      
    

    

    


  </div>
</article>

<div class="container">
  <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
        
      

      
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.ee93f50e7bcdd181a29c10939fba4467.js"></script>

  </body>
</html>

